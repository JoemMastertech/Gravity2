# Configuraci√≥n de Supabase (Producci√≥n)

## üìã Resumen T√©cnico
El sistema utiliza una estrategia de **M√∫ltiples Tablas Especializadas** gestionadas por `ProductDataAdapter.js`.
No existe una √∫nica tabla "productos". Cada categor√≠a tiene su propia tabla SQL, lo que permite campos espec√≠ficos (ej: licores tienen precios por botella/copa).

## üîß Configuraci√≥n de Conexi√≥n
El sistema se conecta autom√°ticamente usando las variables de entorno definidas en `.env`:
- `VITE_SUPABASE_URL`
- `VITE_SUPABASE_ANON_KEY`

El adaptador (`ProductDataAdapter`) maneja la sincronizaci√≥n en background y el cach√© local (`SimpleCache`) para garantizar velocidad instant√°nea.

## üìä Esquema de Base de Datos
Debes tener creadas las siguientes tablas en tu proyecto Supabase.

### 1. Tablas Principales (Alimentos y Bebidas Simples)
Campos comunes: `id`, `nombre`, `precio`, `descripcion`, `imagen`, `disponible`.
*Nota: `cervezas` y `refrescos` usan `ruta_archivo` en lugar de `imagen` para compatibilidad legacy.*

- `cocteleria` (Campos extra: `ingredientes`, `video`)
- `refrescos`
- `cervezas`
- `pizzas`
- `alitas`
- `sopas`
- `ensaladas`
- `carnes`
- `platos_fuertes`
- `cafe`
- `postres`
- `snacks`
- `bebidas`
- `espumosos`

### 2. Tablas de Licores (Estructura Compleja)
Estas tablas no usan un precio √∫nico, sino m√∫ltiples precios y mezcladores.
Campos espec√≠ficos: `precioBotella`, `precioLitro`, `precioCopa`, `mixers_botella`, `mixers_litro`, `mixers_copa`.

- `vodka`
- `whisky`
- `tequila`
- `ron`
- `brandy`
- `cognac`
- `digestivos`
- `ginebra`
- `mezcal`
- `licores` (Gen√©rico)

## üèóÔ∏è Definici√≥n de Tablas (SQL Reference)

### Tabla Est√°ndar (Ej: Cocteler√≠a/Alimentos)
```sql
CREATE TABLE cocteleria (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  nombre TEXT NOT NULL,
  precio NUMERIC,
  descripcion TEXT,
  imagen TEXT, -- URL de la imagen (Storage)
  video TEXT,  -- URL del video (Storage)
  ingredientes TEXT,
  disponible BOOLEAN DEFAULT true
);
```

### Tabla de Licores (Ej: Tequila)
```sql
CREATE TABLE tequila (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  nombre TEXT NOT NULL,
  descripcion TEXT,
  imagen TEXT,
  -- Precios Espec√≠ficos
  precio_botella NUMERIC,
  precio_litro NUMERIC,
  precio_copa NUMERIC,
  -- Mixers (JSON o Array de IDs)
  mixers_botella JSONB,
  mixers_litro JSONB,
  mixers_copa JSONB,
  disponible BOOLEAN DEFAULT true
);
```

### Tabla de Cervezas/Refrescos (Campos Legacy)
```sql
CREATE TABLE cervezas (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  nombre TEXT NOT NULL,
  precio NUMERIC,
  ruta_archivo TEXT, -- Importante: Usa ruta_archivo en lugar de imagen
  disponible BOOLEAN DEFAULT true
);
```

## üîÑ Sincronizaci√≥n y Cach√©
1. **Carga Inicial:** El sistema intenta cargar de Supabase.
2. **Fallback:** Si falla o la tabla est√° vac√≠a, usa datos locales (`ProductData.js`).
3. **Background Sync:** Si hay datos locales, muestra eso primero y actualiza de Supabase en segundo plano.
4. **Persistencia:** Los datos se guardan en `SimpleCache` (localStorage) por 1 hora.

## ‚ö†Ô∏è Soluci√≥n de Problemas Comunes
- **Las im√°genes no cargan:** Verifica si la tabla usa `imagen` o `ruta_archivo`. El adaptador intenta normalizarlo, pero lo ideal es ser consistente.
- **Precios en 0:** Si es un licor, aseg√∫rate de llenar `precio_botella` (snake_case).
  - **Nota Importante:** El sistema acepta `precio_botella` o `precioBotella`. Zod los normaliza autom√°ticamente.
  - Si el valor es texto ("$100.00"), Zod lo convertir√° a n√∫mero (100).
  - Si el valor es `null`, Zod asignar√° `0` para evitar crashes.
- **Tabla no encontrada (404):** El sistema ignorar√° silenciosamente las tablas que no existen y usar√° datos locales.